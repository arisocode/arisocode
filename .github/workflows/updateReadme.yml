name: Update README Activity

on:
  workflow_dispatch:
  schedule:
    - cron: "*/30 * * * *"

permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');

            const readmePath = 'README.md';
            const readme = fs.readFileSync(readmePath, 'utf8');

            const start = '<!--START_SECTION:activity-->';
            const end = '<!--END_SECTION:activity-->';

            if (!readme.includes(start) || !readme.includes(end)) {
              core.setFailed('Activity markers not found');
              return;
            }

            const now = new Date().toLocaleString('es-CO');

            const activity = [
              `- ðŸ•’ Ãšltima ejecuciÃ³n: **${now}**`,
              `- âœ… Workflow funcionando correctamente`
            ].join('\n');

            const updated =
              readme.split(start)[0] +
              start + '\n' +
              activity + '\n' +
              end +
              readme.split(end)[1];

            fs.writeFileSync(readmePath, updated);
